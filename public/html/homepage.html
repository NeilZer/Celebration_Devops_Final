<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>celebration by OREL</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/styles2.css">
    <link rel="stylesheet" href="/css/styles3.css">
    <link rel="stylesheet" href="/css/stylesFINAL.css">
    <script src="/js/script.js" defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        // שליפת מוצרים מה-API שלך
        const response = await fetch('/api/products');
        const products = await response.json();

        // סידור לפי קטגוריה/קונספט/הכל
        const byCategory = {};
        const byEvent = {};
        products.forEach(product => {
          if (product.category) {
            byCategory[product.category] = byCategory[product.category] || [];
            byCategory[product.category].push(product);
          }
          if (product.event) {
            byEvent[product.event] = byEvent[product.event] || [];
            byEvent[product.event].push(product);
          }
        });

        // פונקציית עזר לבניית HTML של מוצר
        function productCard(prod) {
          return `
            <div class="product-card">
              <img src="${prod.image}" alt="${prod.name}" class="product-image">
              <h3>${prod.name}</h3>
              <p>${prod.description}</p>
              <div class="price">${prod.price} ₪</div>
              <button onclick="addToCart('${prod._id}', '${prod.name}', ${prod.price})">הוסף לעגלה</button>
            </div>
          `;
        }

        // כל המוצרים
        document.getElementById('all').innerHTML = `
          <div class="products-list">
            ${products.map(productCard).join('')}
          </div>
        `;

        // לפי קונספט (קטגוריה)
        document.getElementById('concept').innerHTML = Object.keys(byCategory).map(cat => `
          <h2>${cat}</h2>
          <div class="products-list">
            ${byCategory[cat].map(productCard).join('')}
          </div>
        `).join('');

        // לפי אירוע (אם קיים בשדות, אחרת אפשר להסתיר)
        if (Object.keys(byEvent).length) {
          document.getElementById('event').innerHTML = Object.keys(byEvent).map(ev => `
            <h2>${ev}</h2>
            <div class="products-list">
              ${byEvent[ev].map(productCard).join('')}
            </div>
          `).join('');
        } else {
          document.getElementById('event').innerHTML = "<p>אין אירועים זמינים.</p>";
        }

        // ברירת מחדל: להציג את כל המוצרים
        showTab('all');
      });

      // פונקציית החלפת טאבים (אם כבר קיימת ב-js/script.js, אפשר למחוק)
      function showTab(tabName) {
        ['concept', 'event', 'all'].forEach(tab => {
          document.getElementById(tab).style.display = (tab === tabName) ? 'block' : 'none';
        });
      }
    </script>
</head>

<body>
    <header>
        <h1>celebration by OREL</h1>
        <div id="user-greeting">
            <form id="login-form" onsubmit="updateGreeting(); return false;">
                <input type="text" id="fullname" placeholder="הכנס שם מלא" required>
                <button type="submit">התחבר</button>
            </form>
        </div>
    </header>

    <nav>
        <a href="#about">אודות</a>
        <a href="/html/contact.html">צור קשר</a>
        <a href="/html/qa.html">שאלות ותשובות</a>
        <a href="/html/homepage.html">עמוד הבית</a>
        <a href="#cart" onclick="toggleCart()">עגלת קניות <span id="cart-count">0</span></a>
    </nav>
    <div>
        <div id="cart-content" class="cart-content"> 
            <h2>עגלת קניות</h2>
            <span class="exit-button" onclick="toggleCart()">X</span>
            <button class="clear-cart-button" onclick="clearCart()">נקה עגלה</button>
            <table>
                <thead>
                    <tr>
                        <th>שם המוצר</th>
                        <th>מחיר</th>
                        <th>כמות</th>
                        <th>סך הכל</th>
                        <th>פעולות</th>
                    </tr>
                </thead>
                <tbody id="cart-items"></tbody>
            </table>
            <div id="total-price">סכום כולל: 0 ש"ח</div>
            <button class="button" onclick="proceedToCheckout()">לתשלום</button>
        </div>
        <div class="tabs">
            <div class="tab" onclick="showTab('concept')">לפי קונספט</div>
            <div class="tab" onclick="showTab('event')">לפי אירוע</div>
            <div class="tab" onclick="showTab('all')">כל המוצרים</div>
        </div>
    </div>
    <div id="concept" class="tab-content"></div>
    <div id="event" class="tab-content"></div>
    <div id="all" class="tab-content"></div>

    <div id="whatsapp-icon" style="position: fixed; bottom: 20px; left: 20px;">
        <a href="https://www.whatsapp.com/"><img src="/images/whatsapp_icon.png" alt="אייקון ווצאפ" width="50"></a>
    </div>
</body>
</html>
